package rishl7

import "net/http"
import "strconv"

import "encoding/json"
import "errors"
import "io/ioutil"
import "log"

import "encoding/base64"


const htmlData = "PCFkb2N0eXBlIGh0bWw+DQoNCjxodG1sPg0KDQo8aGVhZD4NCiAgICA8dGl0bGU+SGw3IFVJPC90aXRsZT4NCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4NCiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vbmV0ZG5hLmJvb3RzdHJhcGNkbi5jb20vYm9vdHN3YXRjaC8zLjAuMC9zbGF0ZS9ib290c3RyYXAubWluLmNzcyI+DQogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iaHR0cHM6Ly9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvbGlicy9qcXVlcnkvMi4wLjMvanF1ZXJ5Lm1pbi5qcyI+PC9zY3JpcHQ+DQogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iaHR0cHM6Ly9uZXRkbmEuYm9vdHN0cmFwY2RuLmNvbS9ib290c3RyYXAvMy4xLjEvanMvYm9vdHN0cmFwLm1pbi5qcyI+PC9zY3JpcHQ+DQogICAgPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCiAgICAgICAgYm9keSB7DQogICAgICAgIHBhZGRpbmctdG9wOiAyMHB4Ow0KICAgICAgICB9DQoNCiAgICAgICAgLmZvb3RlciB7DQogICAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZWVlOw0KICAgICAgICBtYXJnaW4tdG9wOiA0MHB4Ow0KICAgICAgICBwYWRkaW5nLXRvcDogNDBweDsNCiAgICAgICAgcGFkZGluZy1ib3R0b206IDQwcHg7DQogICAgICAgIH0NCiAgICAgICAgLyogTWFpbiBtYXJrZXRpbmcgbWVzc2FnZSBhbmQgc2lnbiB1cCBidXR0b24gKi8NCg0KICAgICAgICAuanVtYm90cm9uIHsNCiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsNCiAgICAgICAgfQ0KDQogICAgICAgIC5qdW1ib3Ryb24gLmJ0biB7DQogICAgICAgIGZvbnQtc2l6ZTogMjFweDsNCiAgICAgICAgcGFkZGluZzogMTRweCAyNHB4Ow0KICAgICAgICB9DQogICAgICAgIC8qIEN1c3RvbWl6ZSB0aGUgbmF2LWp1c3RpZmllZCBsaW5rcyB0byBiZSBmaWxsIHRoZSBlbnRpcmUgc3BhY2Ugb2YgdGhlIC5uYXZiYXIgKi8NCg0KICAgICAgICAubmF2LWp1c3RpZmllZCB7DQogICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNlZWU7DQogICAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsNCiAgICAgICAgfQ0KDQogICAgICAgIC5uYXYtanVzdGlmaWVkID4gbGkgPiBhIHsNCiAgICAgICAgcGFkZGluZy10b3A6IDE1cHg7DQogICAgICAgIHBhZGRpbmctYm90dG9tOiAxNXB4Ow0KICAgICAgICBjb2xvcjogIzc3NzsNCiAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNkNWQ1ZDU7DQogICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNlNWU1ZTU7DQogICAgICAgIC8qIE9sZCBicm93c2VycyAqLw0KDQogICAgICAgIGJhY2tncm91bmQtcmVwZWF0OiByZXBlYXQteDsNCiAgICAgICAgLyogUmVwZWF0IHRoZSBncmFkaWVudCAqLw0KDQogICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IC1tb3otbGluZWFyLWdyYWRpZW50KHRvcCwgI2Y1ZjVmNSAwJSwgI2U1ZTVlNSAxMDAlKTsNCiAgICAgICAgLyogRkYzLjYrICovDQoNCiAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIGxlZnQgdG9wLCBsZWZ0IGJvdHRvbSwgY29sb3Itc3RvcCgwJSwgI2Y1ZjVmNSksIGNvbG9yLXN0b3AoMTAwJSwNCiAgICAgICAgI2U1ZTVlNSkpOw0KICAgICAgICAvKiBDaHJvbWUsU2FmYXJpNCsgKi8NCg0KICAgICAgICBiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCh0b3AsICNmNWY1ZjUgMCUsICNlNWU1ZTUgMTAwJSk7DQogICAgICAgIC8qIENocm9tZSAxMCssU2FmYXJpIDUuMSsgKi8NCg0KICAgICAgICBiYWNrZ3JvdW5kLWltYWdlOiAtbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgI2Y1ZjVmNSAwJSwgI2U1ZTVlNSAxMDAlKTsNCiAgICAgICAgLyogSUUxMCsgKi8NCg0KICAgICAgICBiYWNrZ3JvdW5kLWltYWdlOiAtby1saW5lYXItZ3JhZGllbnQodG9wLCAjZjVmNWY1IDAlLCAjZTVlNWU1IDEwMCUpOw0KICAgICAgICAvKiBPcGVyYSAxMS4xMCsgKi8NCg0KICAgICAgICBmaWx0ZXI6IHByb2dpZDogRFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj0nI2Y1ZjVmNScsIGVuZENvbG9yc3RyPScjZTVlNWU1JywNCiAgICAgICAgR3JhZGllbnRUeXBlPTApOw0KICAgICAgICAvKiBJRTYtOSAqLw0KDQogICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCh0b3AsICNmNWY1ZjUgMCUsICNlNWU1ZTUgMTAwJSk7DQogICAgICAgIC8qIFczQyAqLw0KICAgICAgICB9DQoNCiAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYSwNCiAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYTpob3ZlciwNCiAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYTpmb2N1cyB7DQogICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNkZGQ7DQogICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IG5vbmU7DQogICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgM3B4IDdweCByZ2JhKDAsIDAsIDAsIC4xNSk7DQogICAgICAgIH0NCg0KICAgICAgICAubmF2LWp1c3RpZmllZCA+IGxpOmZpcnN0LWNoaWxkID4gYSB7DQogICAgICAgIGJvcmRlci1yYWRpdXM6IDVweCA1cHggMCAwOw0KICAgICAgICB9DQoNCiAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiBsaTpsYXN0LWNoaWxkID4gYSB7DQogICAgICAgIGJvcmRlci1ib3R0b206IDA7DQogICAgICAgIGJvcmRlci1yYWRpdXM6IDAgMCA1cHggNXB4Ow0KICAgICAgICB9DQoNCiAgICAgICAgQG1lZGlhKG1pbi13aWR0aDogNzY4cHgpIHsNCiAgICAgICAgLm5hdi1qdXN0aWZpZWQgew0KICAgICAgICBtYXgtaGVpZ2h0OiA1MnB4Ow0KICAgICAgICB9DQogICAgICAgIC5uYXYtanVzdGlmaWVkID4gbGkgPiBhIHsNCiAgICAgICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjZmZmOw0KICAgICAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjZDVkNWQ1Ow0KICAgICAgICB9DQogICAgICAgIC5uYXYtanVzdGlmaWVkID4gbGk6Zmlyc3QtY2hpbGQgPiBhIHsNCiAgICAgICAgYm9yZGVyLWxlZnQ6IDA7DQogICAgICAgIGJvcmRlci1yYWRpdXM6IDVweCAwIDAgNXB4Ow0KICAgICAgICB9DQogICAgICAgIC5uYXYtanVzdGlmaWVkID4gbGk6bGFzdC1jaGlsZCA+IGEgew0KICAgICAgICBib3JkZXItcmFkaXVzOiAwIDVweCA1cHggMDsNCiAgICAgICAgYm9yZGVyLXJpZ2h0OiAwOw0KICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLyogUmVzcG9uc2l2ZTogUG9ydHJhaXQgdGFibGV0cyBhbmQgdXAgKi8NCg0KICAgICAgICBAbWVkaWEgc2NyZWVuIGFuZChtaW4td2lkdGg6IDc2OHB4KSB7DQogICAgICAgIC8qIFJlbW92ZSB0aGUgcGFkZGluZyB3ZSBzZXQgZWFybGllciAqLw0KDQogICAgICAgIC5tYXN0aGVhZCwgLm1hcmtldGluZywgLmZvb3RlciB7DQogICAgICAgIHBhZGRpbmctbGVmdDogMDsNCiAgICAgICAgcGFkZGluZy1yaWdodDogMDsNCiAgICAgICAgfQ0KICAgICAgICB9DQogICAgPC9zdHlsZT4NCiAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgICAgIGZ1bmN0aW9uIHN3aXRjaGVuY29kZSgpIHsNCiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hlY2tib3gtZW5jIikNCiAgICAgICAgICAgICAgICAuY2hlY2tlZCkgew0KICAgICAgICAgICAgICAgICQoIiN0ZXh0LWFyZWEiKQ0KICAgICAgICAgICAgICAgICAgICAudmFsKGJ0b2EoJCgiI3RleHQtYXJlYSIpDQogICAgICAgICAgICAgICAgICAgICAgICAudmFsKCkpKQ0KICAgICAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgICAgICQoIiN0ZXh0LWFyZWEiKQ0KICAgICAgICAgICAgICAgICAgICAudmFsKGF0b2IoJCgiI3RleHQtYXJlYSIpDQogICAgICAgICAgICAgICAgICAgICAgICAudmFsKCkpKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBzZW5kaGw3ZW5jZGF0YSgpIHsNCiAgICAgICAgICAgIHZhciByZXEgPSB7DQogICAgICAgICAgICAgICAgSGw3Yzogew0KICAgICAgICAgICAgICAgICAgICBTZXJJcDogJCgiI2FkZHJlc3MtaWQiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLnZhbCgpLA0KICAgICAgICAgICAgICAgICAgICBQb3J0OiAkKCIjcG9ydC1pZCIpDQogICAgICAgICAgICAgICAgICAgICAgICAudmFsKCksDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBkYXRhOiAkKCIjdGV4dC1hcmVhIikNCiAgICAgICAgICAgICAgICAgICAgLnZhbCgpDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgICAgICAgICAgdXJsOiAiL3NlbmRtc2ciLA0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsDQogICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHJlcSksDQogICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAidGV4dCINCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGpzb25EYXRhKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBpbmVySHRtbCA9ICIiDQogICAgICAgICAgICAgICAgICAgIGluZXJIdG1sID0gaW5lckh0bWwuY29uY2F0KCc8ZGl2IGNsYXNzPSJhbGVydCBhbGVydC13YXJuaW5nIGFsZXJ0LWRpc21pc3NhYmxlIj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImNsb3NlIiBkYXRhLWRpc21pc3M9ImFsZXJ0Ij4mdGltZXM7PC9idXR0b24+PGI+SGw3IHNlcnZlciByZXNwb25zZTwvYj4gJykNCiAgICAgICAgICAgICAgICAgICAgaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoanNvbkRhdGEpDQogICAgICAgICAgICAgICAgICAgIGluZXJIdG1sID0gaW5lckh0bWwuY29uY2F0KCcgPC9kaXY+JykNCiAgICAgICAgICAgICAgICAgICAgJCgiI3dlbGwtaWQiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChpbmVySHRtbCkNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihqc29uRGF0YSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaW5lckh0bWwgPSAiIg0KICAgICAgICAgICAgICAgICAgICBpbmVySHRtbCA9IGluZXJIdG1sLmNvbmNhdCgnPGRpdiBjbGFzcz0iYWxlcnQgYWxlcnQtd2FybmluZyBhbGVydC1kaXNtaXNzYWJsZSI+PGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJjbG9zZSIgZGF0YS1kaXNtaXNzPSJhbGVydCI+JnRpbWVzOzwvYnV0dG9uPjxwPkNvbm5ldGlvbiBlcnJvcjwvcD4gJykNCiAgICAgICAgICAgICAgICAgICAgaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoSlNPTi5zdHJpbmdpZnkoanNvbkRhdGEpKQ0KICAgICAgICAgICAgICAgICAgICBpbmVySHRtbCA9IGluZXJIdG1sLmNvbmNhdCgnIDwvZGl2PicpDQogICAgICAgICAgICAgICAgICAgICQoIiN3ZWxsLWlkIikNCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoaW5lckh0bWwpDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgfQ0KDQoNCiAgICA8L3NjcmlwdD4NCjwvaGVhZD4NCg0KPGJvZHk+DQo8ZGl2IGNsYXNzPSJjb250YWluZXIiPg0KICAgIDxkaXYgY2xhc3M9IndlbGwiIGlkPSJ3ZWxsLWlkIj4NCiAgICAgICAgPGRpdiBjbGFzcz0icGFuZWwtZm9vdGVyIj5ITDcgU2VydmVyIHNldHRpbmdzDQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8dGFibGUgY2xhc3M9InRhYmxlIHRhYmxlLWJvcmRlcmVkIHRhYmxlLWNvbmRlbnNlZCB0YWJsZS1ob3ZlciB0YWJsZS1zdHJpcGVkIj4NCiAgICAgICAgICAgIDx0Ym9keT4NCiAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICA8dGQ+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJjb250cm9sLWxhYmVsIj5ITDcgc2VydmVyIGFkZHJlc3M8L2xhYmVsPg0KDQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250cm9scyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJhZGRyZXNzLWlkIiB2YWx1ZT0iMTkyLjE2OC4xMjMuMTA3IiB0eXBlPSJ0ZXh0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPlBvcnQgbnVtYmVyPC9sYWJlbD4NCg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbHMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0icG9ydC1pZCIgdmFsdWU9IjE5MDE4IiB0eXBlPSJ0ZXh0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgIDx0ZD4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPjwvbGFiZWw+DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRyb2xzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBvbmNsaWNrPSJzZW5kaGw3ZW5jZGF0YSgpIiBjbGFzcz0iYnRuIHB1bGwtbGVmdCBidG4taW5mbyI+UyBFIE4gRDwvYT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgIDwvdGJvZHk+DQogICAgICAgIDwvdGFibGU+DQogICAgICAgIDxkaXYgY2xhc3M9InBhbmVsLWZvb3RlciIgaWQ9InNlYXJjaC1mb290ZXIiPkVjbm9kZWQgRGF0YQ0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPHRleHRhcmVhIGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtYmxvY2stbGV2ZWwiIHN0eWxlPSJtYXJnaW4tdG9wOiAwcHg7IG1hcmdpbi1ib3R0b206IDBweDsgaGVpZ2h0OiAzNjBweDsiDQogICAgICAgICAgICAgICAgICBpZD0idGV4dC1hcmVhIj48L3RleHRhcmVhPg0KDQogICAgICAgIDxkaXYgY2xhc3M9ImNoZWNrYm94Ij4NCiAgICAgICAgICAgIDxsYWJlbD4NCiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJjaGVja2JveC1lbmMiIG9uY2xpY2s9InN3aXRjaGVuY29kZSgpIiB2YWx1ZT0idHJ1ZSI+RW5jb2RlIHRvIEJhc2U2NDwvbGFiZWw+DQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KPC9kaXY+DQo8L2JvZHk+DQoNCjwvaHRtbD4NCg=="

//main srv class
type HL7Js struct {
	hl7c HL7Client
}

//start and init srv
func (srv *HL7Js) Start(listenPort int) error {
	http.HandleFunc("/sendmsg", srv.SendMsg)
	http.HandleFunc("/", srv.Redirect)
	http.HandleFunc("/index.html", srv.index)
	if err := http.ListenAndServe(":"+strconv.Itoa(listenPort), nil); err != nil {
		return errors.New("error: can't start listen http server")
	}
	return nil
}

//serve main page request
func (srv *HL7Js) index(rwr http.ResponseWriter, req *http.Request) {
	rwr.Header().Set("Content-Type: text/html", "*")

	content, err := ioutil.ReadFile("index.html")
	if err != nil {
		log.Println("warning: start page not found, return included page")
		val, _ := base64.StdEncoding.DecodeString(htmlData)
		rwr.Write(val)
		return
	}
	rwr.Write(content)
}

func (service *HL7Js) Redirect(responseWriter http.ResponseWriter, request *http.Request) {
	http.Redirect(responseWriter, request, "/index.html", 301)
}

//serve cEcho responce
func (srv *HL7Js) SendMsg(rwr http.ResponseWriter, httpreq *http.Request) {
	defer httpreq.Body.Close()
	bodyData, err := ioutil.ReadAll(httpreq.Body)
	if err != nil {
		strErr := "error: Can't read http body data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	//parse http request
	var req Hl7Request
	if err := json.Unmarshal(bodyData, &req); err != nil {
		strErr := "error: can't parse request data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	//parse decode base64 encoded data
	data, err := base64.StdEncoding.DecodeString(req.Data)
	if err != nil {
		log.Println(err)
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return
	}
	//use hl7 client to send data
	redat, err := srv.hl7c.SendHL7Data(data, req.Hl7c)
	if err != nil {
		log.Println(err)
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return

	}
	//send
	rwr.Write(redat)
}
