package main

import "net/http"
import "strconv"

import "encoding/json"
import "errors"
import "io/ioutil"
import "log"

import "encoding/base64"

const htmlData = "PCFkb2N0eXBlIGh0bWw+DQoNCjxodG1sPg0KDQo8aGVhZD4NCiAgICA8dGl0bGU+ZHRvb2xzIFVJPC90aXRsZT4NCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4NCiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vbmV0ZG5hLmJvb3RzdHJhcGNkbi5jb20vYm9vdHN3YXRjaC8zLjAuMC9zbGF0ZS9ib290c3RyYXAubWluLmNzcyI+DQogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzIuMC4zL2pxdWVyeS5taW4uanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+DQogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vbmV0ZG5hLmJvb3RzdHJhcGNkbi5jb20vYm9vdHN0cmFwLzMuMS4xL2pzL2Jvb3RzdHJhcC5taW4uanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+DQogICAgPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCiAgICAgICAgYm9keSB7DQogICAgICAgICAgICBwYWRkaW5nLXRvcDogMjBweDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLmZvb3RlciB7DQogICAgICAgICAgICBib3JkZXItdG9wOiAxcHggc29saWQgI2VlZTsNCiAgICAgICAgICAgIG1hcmdpbi10b3A6IDQwcHg7DQogICAgICAgICAgICBwYWRkaW5nLXRvcDogNDBweDsNCiAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiA0MHB4Ow0KICAgICAgICB9DQogICAgICAgIC8qIE1haW4gbWFya2V0aW5nIG1lc3NhZ2UgYW5kIHNpZ24gdXAgYnV0dG9uICovDQogICAgICAgIA0KICAgICAgICAuanVtYm90cm9uIHsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAuanVtYm90cm9uIC5idG4gew0KICAgICAgICAgICAgZm9udC1zaXplOiAyMXB4Ow0KICAgICAgICAgICAgcGFkZGluZzogMTRweCAyNHB4Ow0KICAgICAgICB9DQogICAgICAgIC8qIEN1c3RvbWl6ZSB0aGUgbmF2LWp1c3RpZmllZCBsaW5rcyB0byBiZSBmaWxsIHRoZSBlbnRpcmUgc3BhY2Ugb2YgdGhlIC5uYXZiYXIgKi8NCiAgICAgICAgDQogICAgICAgIC5uYXYtanVzdGlmaWVkIHsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNlZWU7DQogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1cHg7DQogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAubmF2LWp1c3RpZmllZCA+IGxpID4gYSB7DQogICAgICAgICAgICBwYWRkaW5nLXRvcDogMTVweDsNCiAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAxNXB4Ow0KICAgICAgICAgICAgY29sb3I6ICM3Nzc7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZDVkNWQ1Ow0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2U1ZTVlNTsNCiAgICAgICAgICAgIC8qIE9sZCBicm93c2VycyAqLw0KICAgICAgICAgICAgDQogICAgICAgICAgICBiYWNrZ3JvdW5kLXJlcGVhdDogcmVwZWF0LXg7DQogICAgICAgICAgICAvKiBSZXBlYXQgdGhlIGdyYWRpZW50ICovDQogICAgICAgICAgICANCiAgICAgICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IC1tb3otbGluZWFyLWdyYWRpZW50KHRvcCwgI2Y1ZjVmNSAwJSwgI2U1ZTVlNSAxMDAlKTsNCiAgICAgICAgICAgIC8qIEZGMy42KyAqLw0KICAgICAgICAgICAgDQogICAgICAgICAgICBiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWdyYWRpZW50KGxpbmVhciwgbGVmdCB0b3AsIGxlZnQgYm90dG9tLCBjb2xvci1zdG9wKDAlLCAjZjVmNWY1KSwgY29sb3Itc3RvcCgxMDAlLCAjZTVlNWU1KSk7DQogICAgICAgICAgICAvKiBDaHJvbWUsU2FmYXJpNCsgKi8NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQodG9wLCAjZjVmNWY1IDAlLCAjZTVlNWU1IDEwMCUpOw0KICAgICAgICAgICAgLyogQ2hyb21lIDEwKyxTYWZhcmkgNS4xKyAqLw0KICAgICAgICAgICAgDQogICAgICAgICAgICBiYWNrZ3JvdW5kLWltYWdlOiAtbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgI2Y1ZjVmNSAwJSwgI2U1ZTVlNSAxMDAlKTsNCiAgICAgICAgICAgIC8qIElFMTArICovDQogICAgICAgICAgICANCiAgICAgICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IC1vLWxpbmVhci1ncmFkaWVudCh0b3AsICNmNWY1ZjUgMCUsICNlNWU1ZTUgMTAwJSk7DQogICAgICAgICAgICAvKiBPcGVyYSAxMS4xMCsgKi8NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZmlsdGVyOiBwcm9naWQ6IERYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LmdyYWRpZW50KHN0YXJ0Q29sb3JzdHI9JyNmNWY1ZjUnLCBlbmRDb2xvcnN0cj0nI2U1ZTVlNScsIEdyYWRpZW50VHlwZT0wKTsNCiAgICAgICAgICAgIC8qIElFNi05ICovDQogICAgICAgICAgICANCiAgICAgICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCh0b3AsICNmNWY1ZjUgMCUsICNlNWU1ZTUgMTAwJSk7DQogICAgICAgICAgICAvKiBXM0MgKi8NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYSwNCiAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYTpob3ZlciwNCiAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYTpmb2N1cyB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZGRkOw0KICAgICAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogbm9uZTsNCiAgICAgICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgM3B4IDdweCByZ2JhKDAsIDAsIDAsIC4xNSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC5uYXYtanVzdGlmaWVkID4gbGk6Zmlyc3QtY2hpbGQgPiBhIHsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweCA1cHggMCAwOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAubmF2LWp1c3RpZmllZCA+IGxpOmxhc3QtY2hpbGQgPiBhIHsNCiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDA7DQogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAwIDAgNXB4IDVweDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgQG1lZGlhKG1pbi13aWR0aDogNzY4cHgpIHsNCiAgICAgICAgICAgIC5uYXYtanVzdGlmaWVkIHsNCiAgICAgICAgICAgICAgICBtYXgtaGVpZ2h0OiA1MnB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiBsaSA+IGEgew0KICAgICAgICAgICAgICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgI2ZmZjsNCiAgICAgICAgICAgICAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjZDVkNWQ1Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiBsaTpmaXJzdC1jaGlsZCA+IGEgew0KICAgICAgICAgICAgICAgIGJvcmRlci1sZWZ0OiAwOw0KICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweCAwIDAgNXB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLm5hdi1qdXN0aWZpZWQgPiBsaTpsYXN0LWNoaWxkID4gYSB7DQogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMCA1cHggNXB4IDA7DQogICAgICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8qIFJlc3BvbnNpdmU6IFBvcnRyYWl0IHRhYmxldHMgYW5kIHVwICovDQogICAgICAgIA0KICAgICAgICBAbWVkaWEgc2NyZWVuIGFuZChtaW4td2lkdGg6IDc2OHB4KSB7DQogICAgICAgICAgICAvKiBSZW1vdmUgdGhlIHBhZGRpbmcgd2Ugc2V0IGVhcmxpZXIgKi8NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLm1hc3RoZWFkLCAubWFya2V0aW5nLCAuZm9vdGVyIHsNCiAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDA7DQogICAgICAgICAgICAgICAgcGFkZGluZy1yaWdodDogMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIDwvc3R5bGU+DQogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgICAgICBmdW5jdGlvbiBzZW5kYWR0MDEoKSB7DQogICAgICAgICAgICB2YXIgQURUMDFSZXEgPSB7DQogICAgICAgICAgICAgICAgSGw3Yzogew0KICAgICAgICAgICAgICAgICAgICBTZXJJcDogJCgiI2FkZHJlc3MtaWQiKS52YWwoKSwNCiAgICAgICAgICAgICAgICAgICAgUG9ydDogJCgiI3BvcnQtaWQiKS52YWwoKSwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIFBkOiB7DQogICAgICAgICAgICAgICAgICAgIFB0TmFtZTogJCgiI3BhdGllbnQtbmFtZS1pZCIpLnZhbCgpLA0KICAgICAgICAgICAgICAgICAgICBQdERhdEI6ICQoIiNkYXRlLWJpcnRoLWlkIikudmFsKCksDQogICAgICAgICAgICAgICAgICAgIFB0TXJuOiAkKCIjbXJuLW51bWJlci1pZCIpLnZhbCgpLA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgICAgICB1cmw6ICIvc2VuZGFkdDAxIiwNCiAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsDQogICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoQURUMDFSZXEpLA0KICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAidGV4dCINCiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oanNvbkRhdGEpIHsNCiAgICAgICAgICAgICAgICB2YXIgaW5lckh0bWwgPSAiIg0KICAgICAgICAgICAgICAgIGluZXJIdG1sID0gaW5lckh0bWwuY29uY2F0KCc8ZGl2IGNsYXNzPSJhbGVydCBhbGVydC13YXJuaW5nIGFsZXJ0LWRpc21pc3NhYmxlIj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImNsb3NlIiBkYXRhLWRpc21pc3M9ImFsZXJ0Ij4mdGltZXM7PC9idXR0b24+PGI+SGw3IHNlcnZlciByZXNwb25zZTwvYj4gJykNCiAgICAgICAgICAgICAgICBpbmVySHRtbCA9IGluZXJIdG1sLmNvbmNhdChqc29uRGF0YSkNCiAgICAgICAgICAgICAgICBpbmVySHRtbCA9IGluZXJIdG1sLmNvbmNhdCgnIDwvZGl2PicpDQogICAgICAgICAgICAgICAgJCgiI3dlbGwtaWQiKS5hcHBlbmQoaW5lckh0bWwpDQogICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihqc29uRGF0YSkgew0KICAgICAgICAgICAgICAgIHZhciBpbmVySHRtbCA9ICIiDQogICAgICAgICAgICAgICAgaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJzxkaXYgY2xhc3M9ImFsZXJ0IGFsZXJ0LXdhcm5pbmcgYWxlcnQtZGlzbWlzc2FibGUiPjxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0iYWxlcnQiPiZ0aW1lczs8L2J1dHRvbj48cD5Db25uZXRpb24gZXJyb3I8L3A+ICcpDQogICAgICAgICAgICAgICAgaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJyA8L2Rpdj4nKQ0KICAgICAgICAgICAgICAgICQoIiN3ZWxsLWlkIikuYXBwZW5kKGluZXJIdG1sKQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KPC9oZWFkPg0KDQo8Ym9keT4NCiAgICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPg0KICAgICAgICA8ZGl2IGNsYXNzPSJ3ZWxsIiBpZD0id2VsbC1pZCI+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwYW5lbC1mb290ZXIiPkhMNyBTZXJ2ZXIgc2V0dGluZ3MNCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJ0YWJsZSB0YWJsZS1ib3JkZXJlZCB0YWJsZS1jb25kZW5zZWQgdGFibGUtaG92ZXIgdGFibGUtc3RyaXBlZCI+DQogICAgICAgICAgICAgICAgPHRib2R5Pg0KICAgICAgICAgICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgICAgICAgICA8dGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iY29udHJvbC1sYWJlbCI+SEw3IHNlcnZlciBhZGRyZXNzPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbHMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJhZGRyZXNzLWlkIiB2YWx1ZT0iMTkyLjE2OC4xMjMuMTA3IiB0eXBlPSJ0ZXh0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHRkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPlBvcnQgbnVtYmVyPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbHMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJwb3J0LWlkIiB2YWx1ZT0iMTkwMTkiIHR5cGU9InRleHQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+DQoNCiAgICAgICAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgICA8L3Rib2R5Pg0KICAgICAgICAgICAgPC90YWJsZT4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBhbmVsLWZvb3RlciIgaWQ9InNlYXJjaC1mb290ZXIiPlNlYXJjaCBTZXR0aW5nczwvZGl2Pg0KICAgICAgICAgICAgPHRhYmxlIGlkPSJzZWFyY2gtcGFuZWwiIGNsYXNzPSJ0YWJsZSB0YWJsZS1ib3JkZXJlZCB0YWJsZS1jb25kZW5zZWQgdGFibGUtaG92ZXIgdGFibGUtc3RyaXBlZCI+DQogICAgICAgICAgICAgICAgPHRib2R5Pg0KICAgICAgICAgICAgICAgICAgICA8dHI+DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJjb250cm9sLWxhYmVsIj5Ncm4gbnVtYmVyPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbHMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJtcm4tbnVtYmVyLWlkIiB2YWx1ZT0iMTAwIiB0eXBlPSJ0ZXh0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHRkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPlBhdGllbnQgbmFtZTwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRyb2xzIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0icGF0aWVudC1uYW1lLWlkIiB2YWx1ZT0iSXZhbiIgdHlwZT0idGV4dCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJjb250cm9sLWxhYmVsIj5EYXRlIG9mIGJpcnRoPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbHMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJkYXRlLWJpcnRoLWlkIiB2YWx1ZT0iMTk0NzA0MTUiIHR5cGU9InRleHQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJjb250cm9sLWxhYmVsIj48L2xhYmVsPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250cm9scyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBvbmNsaWNrPSJzZW5kYWR0MDEoKSIgY2xhc3M9ImJ0biBwdWxsLWxlZnQgYnRuLWluZm8iPlMgRSBOIEQ8L2E+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgICA8L3Rib2R5Pg0KICAgICAgICAgICAgPC90YWJsZT4NCg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCjwvYm9keT4NCg0KPC9odG1sPg=="

//main srv class
type HL7Js struct {
	hl7c HL7Client
}

//start and init srv
func (srv *HL7Js) Start(listenPort int) error {
	http.HandleFunc("/sendadt01", srv.SendADTA01)
	http.HandleFunc("/", srv.Redirect)
	http.HandleFunc("/index.html", srv.index)
	if err := http.ListenAndServe(":"+strconv.Itoa(listenPort), nil); err != nil {
		return errors.New("error: can't start listen http server")
	}
	return nil
}

//serve main page request
func (srv *HL7Js) index(rwr http.ResponseWriter, req *http.Request) {
	rwr.Header().Set("Content-Type: text/html", "*")

	content, err := ioutil.ReadFile("index.html")
	if err != nil {
		log.Println("warning: start page not found, return included page")
		val, _ := base64.StdEncoding.DecodeString(htmlData)
		rwr.Write(val)
		return
	}
	rwr.Write(content)
}

func (service *HL7Js) Redirect(responseWriter http.ResponseWriter, request *http.Request) {
	http.Redirect(responseWriter, request, "/index.html", 301)
}

//serve cEcho responce
func (srv *HL7Js) SendADTA01(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()
	bodyData, err := ioutil.ReadAll(req.Body)
	if err != nil {
		strErr := "error: Can't read http body data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	var adtreq ADT01Req
	if err := json.Unmarshal(bodyData, &adtreq); err != nil {
		strErr := "error: can't parse ADT01Req data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}

	log.Println(adtreq)
	redat, err := srv.hl7c.ADTA01(adtreq.Pd, adtreq.Hl7c)
	if err != nil {
		log.Println(err)
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return

	}
	rwr.Write(redat)
}
